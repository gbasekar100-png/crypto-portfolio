<!DOCTYPE html>
<html>
<head>
  <title>Simple Crypto Portfolio Tracker</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f5f5f5; }
    table { border-collapse: collapse; width: 100%; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #4CAF50; color: white; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    input { margin-bottom: 10px; }
    .profit-positive { color: green; }
    .profit-negative { color: red; }
  </style>
</head>
<body>
  <h1>Crypto Portfolio Tracker</h1>
  <input type="file" id="fileInput" accept=".csv" />
  <table id="portfolioTable" style="display:none;">
    <thead>
      <tr>
        <th>#</th>
        <th>Crypto Name</th>
        <th>Amount</th>
        <th>Price Invested</th>
        <th>Liquidation Price</th>
        <th>Leverage X</th>
        <th>Exchange</th>
        <th>Current Price</th>
        <th>Market Value</th>
        <th>Profit $</th>
        <th>Profit %</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script>
    document.getElementById("fileInput").addEventListener("change", function(e){
      const file = e.target.files[0];
      Papa.parse(file, {
        header: true,
        skipEmptyLines: true,
        complete: async function(results){
          const portfolio = results.data;
          const tbody = document.querySelector("#portfolioTable tbody");
          tbody.innerHTML = "";
          document.getElementById("portfolioTable").style.display = "table";

          // Fetch live prices from CoinGecko
          const ids = portfolio.map(p => p.CryptoName.toLowerCase()).join(',');
          const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
          const prices = await res.json();

          portfolio.forEach((p, idx) => {
            const currentPrice = prices[p.CryptoName.toLowerCase()]?.usd || 0;
            const invested = parseFloat(p.Amount) * parseFloat(p.PriceInvestedAt);
            const marketValue = parseFloat(p.Amount) * currentPrice;
            const profit = marketValue - invested;
            const profitPct = invested ? ((profit / invested) * 100).toFixed(2) : 0;

            const row = `<tr>
              <td>${idx+1}</td>
              <td>${p.CryptoName}</td>
              <td>${p.Amount}</td>
              <td>${p.PriceInvestedAt}</td>
              <td>${p.LiquidationPrice || 'N/A'}</td>
              <td>${p.LeverageX || 'N/A'}</td>
              <td>${p.Exchange || 'N/A'}</td>
              <td>${currentPrice}</td>
              <td>${marketValue.toFixed(2)}</td>
              <td class="${profit>=0?'profit-positive':'profit-negative'}">${profit.toFixed(2)}</td>
              <td class="${profit>=0?'profit-positive':'profit-negative'}">${profitPct}</td>
            </tr>`;
            tbody.innerHTML += row;
          });
        }
      });
    });
  </script>
</body>
</html>
